
create proc GetStockCount
as
select distinct COUNT(*) from Stock s where s.QTY <= (select y.QtyAlerts from SystemAlerts y)


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetTotalStockCount
as
select distinct COUNT(*) from Stock s

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetAvilableStockCount
as
select distinct COUNT(*) from Stock s where s.QTY > 0

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetEndStockCount
as
select distinct COUNT(*) from Stock s where s.QTY = 0

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[GetAllPurchases]    Script Date: 2023-11-24 5:01:05 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[GetAllPurchases]
as
SELECT distinct p.[Id] as '«·„⁄—›'
      ,p.[InvoiceNumber] as '—ﬁ„ «·›« Ê—…'
      ,s.Name as '«·„Ê—œ'
      ,p.[DateOfPurchase] as ' «—ÌŒ «·‘—«¡'
	  ,py.Name as 'ÿ—Ìﬁ… «·œ›⁄'
	  ,p.price as '«Ã„«·Ì «·›« Ê—…'
      ,p.[PaidAmount] as '«·„»·€ «·„œ›Ê⁄'
      ,p.[RemainingAmount] as '«·„»·€ «·„ »ﬁÌ'
	   FROM [dbo].[Purchases] p
  join PurchaseDetails d
  on p.Id = d.PurchaseId
  join Suppliers s
  on 
  p.SupplierId = s.ID
  join Product t
  on
  d.ProductId = t.ID_Product
  join PaymentMethod py
  on py.Id = p.PaymentMethodId
--SELECT p.[Id] as '«·„⁄—›'
--      ,s.Name as '«·„Ê—œ'
--      ,t.Product_Name as '«·„‰ Ã'
--      ,p.[DateOfPurchase] as ' «—ÌŒ «·‘—«¡'
--      ,d.ExpDate as ' «—ÌŒ «·’·«ÕÌ…'
--      ,d.[QTY] as '«·ﬂ„Ì…'
--      ,d.PurchasePrice as '”⁄— «·‘—«¡'
--      ,d.SellingPrice as '”⁄— «·»Ì⁄'
--      ,d.TotalPrice as '«·”⁄—'
--      ,p.[PaidAmount] as '«·„»·€ «·„œ›Ê⁄'
--      ,p.[RemainingAmount] as '«·„»·€ «·„ »ﬁÌ'
--      ,p.[PaymentMethodId] as 'ÿ—Ìﬁ… «·œ›⁄'
--      ,p.[InvoiceNumber] as '—ﬁ„ «·›« Ê—…'
--      ,d.BatchNumber as '—ﬁ„ «·œ›⁄…'
--	  ,p.price as '«Ã„«·Ì «·›« Ê—…'
--  FROM [dbo].[Purchases] p
--  join PurchaseDetails d
--  on p.Id = d.PurchaseId
--  join Suppliers s
--  on 
--  p.SupplierId = s.ID
--  join Product t
--  on
--  d.ProductId = t.ID_Product

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[SearchPurchases]    Script Date: 2023-11-24 5:06:29 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[SearchPurchases]
@search nvarchar(50)
as
SELECT distinct p.[Id] as '«·„⁄—›'
      ,p.[InvoiceNumber] as '—ﬁ„ «·›« Ê—…'
      ,s.Name as '«·„Ê—œ'
      ,p.[DateOfPurchase] as ' «—ÌŒ «·‘—«¡'
	  ,py.Name as 'ÿ—Ìﬁ… «·œ›⁄'
	  ,p.price as '«Ã„«·Ì «·›« Ê—…'
      ,p.[PaidAmount] as '«·„»·€ «·„œ›Ê⁄'
      ,p.[RemainingAmount] as '«·„»·€ «·„ »ﬁÌ'
	   FROM [dbo].[Purchases] p
  join PurchaseDetails d
  on p.Id = d.PurchaseId
  join Suppliers s
  on 
  p.SupplierId = s.ID
  join Product t
  on
  d.ProductId = t.ID_Product
  join PaymentMethod py
  on py.Id = p.PaymentMethodId
--SELECT p.[Id] as '«·„⁄—›'
--      ,s.Name as '«·„Ê—œ'
--      ,t.Product_Name as '«·„‰ Ã'
--      ,p.[DateOfPurchase] as ' «—ÌŒ «·‘—«¡'
--      ,d.ExpDate as ' «—ÌŒ «·’·«ÕÌ…'
--      ,d.[QTY] as '«·ﬂ„Ì…'
--      ,d.PurchasePrice as '”⁄— «·‘—«¡'
--      ,d.SellingPrice as '”⁄— «·»Ì⁄'
--      ,d.TotalPrice as '«·”⁄—'
--      ,p.[PaidAmount] as '«·„»·€ «·„œ›Ê⁄'
--      ,p.[RemainingAmount] as '«·„»·€ «·„ »ﬁÌ'
--      ,p.[PaymentMethodId] as 'ÿ—Ìﬁ… «·œ›⁄'
--      ,p.[InvoiceNumber] as '—ﬁ„ «·›« Ê—…'
--      ,d.BatchNumber as '—ﬁ„ «·œ›⁄…'
--	  ,p.price as '«Ã„«·Ì «·›« Ê—…'
--  FROM [dbo].[Purchases] p
--  join PurchaseDetails d
--  on p.Id = d.PurchaseId
--  join Suppliers s
--  on 
--  p.SupplierId = s.ID
--  join Product t
--  on
--  d.ProductId = t.ID_Product
  where s.Name  + py.Name  like '%' + @search + '%' 

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetProformaInvoices
@search nvarchar(50)
as
SELECT [ID] as '„⁄—› «·›« Ê—…'
      ,[Date_ProformaInvoice] as ' «—ÌŒ «·›« Ê—…'
      ,c.First_Name + ' ' + c.Last_Name as '«·⁄„Ì·'
      ,[Des_ProformaInvoice] as 'Ê’› «·›« Ê—…'
      ,[SalesMan] as '„” Œ—Ã «·›« Ê—…'
  FROM [Product_DB].[dbo].[ProformaInvoice] pn
  join Customer c
  on pn.Customer_ID = c.ID_Customer
  where CONVERT(nvarchar(50), [Date_ProformaInvoice]) + CONVERT(nvarchar(50), [ID]) + c.First_Name + c.Last_Name + pn.SalesMan like '%' +@search+ '%'

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
