
create proc GetStockCount
as
select distinct COUNT(*) from Stock s where s.QTY <= (select y.QtyAlerts from SystemAlerts y)


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetTotalStockCount
as
select distinct COUNT(*) from Stock s

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetAvilableStockCount
as
select distinct COUNT(*) from Stock s where s.QTY > 0

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetEndStockCount
as
select distinct COUNT(*) from Stock s where s.QTY = 0

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[GetAllPurchases]    Script Date: 2023-11-24 5:01:05 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[GetAllPurchases]
as
SELECT distinct p.[Id] as 'ÇáãÚÑÝ'
      ,p.[InvoiceNumber] as 'ÑÞã ÇáÝÇÊæÑÉ'
      ,s.Name as 'ÇáãæÑÏ'
      ,p.[DateOfPurchase] as 'ÊÇÑíÎ ÇáÔÑÇÁ'
	  ,py.Name as 'ØÑíÞÉ ÇáÏÝÚ'
	  ,p.price as 'ÇÌãÇáí ÇáÝÇÊæÑÉ'
      ,p.[PaidAmount] as 'ÇáãÈáÛ ÇáãÏÝæÚ'
      ,p.[RemainingAmount] as 'ÇáãÈáÛ ÇáãÊÈÞí'
	   FROM [dbo].[Purchases] p
  join PurchaseDetails d
  on p.Id = d.PurchaseId
  join Suppliers s
  on 
  p.SupplierId = s.ID
  join Product t
  on
  d.ProductId = t.ID_Product
  join PaymentMethod py
  on py.Id = p.PaymentMethodId
--SELECT p.[Id] as 'ÇáãÚÑÝ'
--      ,s.Name as 'ÇáãæÑÏ'
--      ,t.Product_Name as 'ÇáãäÊÌ'
--      ,p.[DateOfPurchase] as 'ÊÇÑíÎ ÇáÔÑÇÁ'
--      ,d.ExpDate as 'ÊÇÑíÎ ÇáÕáÇÍíÉ'
--      ,d.[QTY] as 'ÇáßãíÉ'
--      ,d.PurchasePrice as 'ÓÚÑ ÇáÔÑÇÁ'
--      ,d.SellingPrice as 'ÓÚÑ ÇáÈíÚ'
--      ,d.TotalPrice as 'ÇáÓÚÑ'
--      ,p.[PaidAmount] as 'ÇáãÈáÛ ÇáãÏÝæÚ'
--      ,p.[RemainingAmount] as 'ÇáãÈáÛ ÇáãÊÈÞí'
--      ,p.[PaymentMethodId] as 'ØÑíÞÉ ÇáÏÝÚ'
--      ,p.[InvoiceNumber] as 'ÑÞã ÇáÝÇÊæÑÉ'
--      ,d.BatchNumber as 'ÑÞã ÇáÏÝÚÉ'
--	  ,p.price as 'ÇÌãÇáí ÇáÝÇÊæÑÉ'
--  FROM [dbo].[Purchases] p
--  join PurchaseDetails d
--  on p.Id = d.PurchaseId
--  join Suppliers s
--  on 
--  p.SupplierId = s.ID
--  join Product t
--  on
--  d.ProductId = t.ID_Product

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[SearchPurchases]    Script Date: 2023-11-24 5:06:29 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[SearchPurchases]
@search nvarchar(50)
as
SELECT distinct p.[Id] as 'ÇáãÚÑÝ'
      ,p.[InvoiceNumber] as 'ÑÞã ÇáÝÇÊæÑÉ'
      ,s.Name as 'ÇáãæÑÏ'
      ,p.[DateOfPurchase] as 'ÊÇÑíÎ ÇáÔÑÇÁ'
	  ,py.Name as 'ØÑíÞÉ ÇáÏÝÚ'
	  ,p.price as 'ÇÌãÇáí ÇáÝÇÊæÑÉ'
      ,p.[PaidAmount] as 'ÇáãÈáÛ ÇáãÏÝæÚ'
      ,p.[RemainingAmount] as 'ÇáãÈáÛ ÇáãÊÈÞí'
	   FROM [dbo].[Purchases] p
  join PurchaseDetails d
  on p.Id = d.PurchaseId
  join Suppliers s
  on 
  p.SupplierId = s.ID
  join Product t
  on
  d.ProductId = t.ID_Product
  join PaymentMethod py
  on py.Id = p.PaymentMethodId
--SELECT p.[Id] as 'ÇáãÚÑÝ'
--      ,s.Name as 'ÇáãæÑÏ'
--      ,t.Product_Name as 'ÇáãäÊÌ'
--      ,p.[DateOfPurchase] as 'ÊÇÑíÎ ÇáÔÑÇÁ'
--      ,d.ExpDate as 'ÊÇÑíÎ ÇáÕáÇÍíÉ'
--      ,d.[QTY] as 'ÇáßãíÉ'
--      ,d.PurchasePrice as 'ÓÚÑ ÇáÔÑÇÁ'
--      ,d.SellingPrice as 'ÓÚÑ ÇáÈíÚ'
--      ,d.TotalPrice as 'ÇáÓÚÑ'
--      ,p.[PaidAmount] as 'ÇáãÈáÛ ÇáãÏÝæÚ'
--      ,p.[RemainingAmount] as 'ÇáãÈáÛ ÇáãÊÈÞí'
--      ,p.[PaymentMethodId] as 'ØÑíÞÉ ÇáÏÝÚ'
--      ,p.[InvoiceNumber] as 'ÑÞã ÇáÝÇÊæÑÉ'
--      ,d.BatchNumber as 'ÑÞã ÇáÏÝÚÉ'
--	  ,p.price as 'ÇÌãÇáí ÇáÝÇÊæÑÉ'
--  FROM [dbo].[Purchases] p
--  join PurchaseDetails d
--  on p.Id = d.PurchaseId
--  join Suppliers s
--  on 
--  p.SupplierId = s.ID
--  join Product t
--  on
--  d.ProductId = t.ID_Product
  where s.Name  + py.Name  like '%' + @search + '%' 

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetProformaInvoices
@search nvarchar(50)
as
SELECT [ID] as 'ãÚÑÝ ÇáÝÇÊæÑÉ'
      ,[Date_ProformaInvoice] as 'ÊÇÑíÎ ÇáÝÇÊæÑÉ'
      ,c.First_Name + ' ' + c.Last_Name as 'ÇáÚãíá'
      ,[Des_ProformaInvoice] as 'æÕÝ ÇáÝÇÊæÑÉ'
      ,[SalesMan] as 'ãÓÊÎÑÌ ÇáÝÇÊæÑÉ'
  FROM [Product_DB].[dbo].[ProformaInvoice] pn
  join Customer c
  on pn.Customer_ID = c.ID_Customer
  where CONVERT(nvarchar(50), [Date_ProformaInvoice]) + CONVERT(nvarchar(50), [ID]) + c.First_Name + c.Last_Name + pn.SalesMan like '%' +@search+ '%'

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[GetProductPrice]    Script Date: 2023-11-24 6:01:05 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[GetProductPrice]
@search nvarchar(50)
as
SELECT p.[Id] as 'ÇáãÚÑÝ' 
      ,t.ID_Product as 'ãÚÑÝ ÇáãäÊÌ'
      ,t.[Product_Name] as 'ÇáãäÊÌ'
	  ,s.[Name] as 'ÇáãæÑÏ'
      ,[BatchNumber] as 'ÑÞã ÇáÏÝÚÉ'
      ,[PurchasePrice] as 'ÓÚÑ ÇáÔÑÇÁ'
      ,[SellingPrice] as'ÓÚÑ ÇáÈíÚ'
	  ,u.[DateOfPurchase] as 'ÊÇÑíÎ ÇáØáÈíÉ'
  FROM [dbo].[PurchaseDetails] p
  join Product t
  on t.ID_Product = p.ProductId
  join Purchases u
  on u.Id = p.PurchaseId
  join Suppliers s
  on s.ID = u.SupplierId
  where t.Product_Name + s.Name + CONVERT(nvarchar(50),p.BatchNumber) like '%' +@search+ '%'


  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[UpdateProductPrice]    Script Date: 2023-11-24 6:02:06 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER proc [dbo].[UpdateProductPrice]
@productId int,
@SellingPrice int
as
UPDATE [dbo].[PurchaseDetails]
   SET [SellingPrice] = @SellingPrice
 WHERE ProductId = @productId



-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[GetAllOrders]    Script Date: 2023-11-24 6:14:58 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[GetAllOrders]
@search nvarchar(50)
as
SELECT distinct o.[ID_Order] as 'ÇáãÚÑÝ'
      ,[Date_Order] as 'ÊÇÑíÎ ÇáØáÈíÉ'
      ,c.First_Name + ' ' + c.Last_Name as 'ÇáÚãíá'
      ,[Des_Order] as 'æÕÝ ÇáØáÈíÉ'
      ,[SalesMan] as 'ÇáÈÇÆÚ'
      ,[TotalAmount] as 'ÇÌãÇáí ÇáÝÇÊæÑÉ'
      ,[PaidAmount] as 'ÇáãÈáÛ ÇáãÏÝæÚ'
      ,[RemainingAmount] as 'ÇáãÈáÛ ÇáãÊÈÞí'
  FROM [dbo].[Order] o
  join Customer c
  on c.ID_Customer = o.Customer_ID
  join Order_Details dt
  on dt.ID_Order = o.ID_Order
  where CONVERT(nvarchar(50), o.ID_Order) + o.Des_Order + CONVERT(nvarchar(50), o.Date_Order) + c.First_Name + c.Last_Name + o.SalesMan like '%' +@search+ '%'
  and o.TotalAmount > 0


  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

