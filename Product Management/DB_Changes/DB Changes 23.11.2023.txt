
create proc GetStockCount
as
select distinct COUNT(*) from Stock s where s.QTY <= (select y.QtyAlerts from SystemAlerts y)


---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetTotalStockCount
as
select distinct COUNT(*) from Stock s

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetAvilableStockCount
as
select distinct COUNT(*) from Stock s where s.QTY > 0

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetEndStockCount
as
select distinct COUNT(*) from Stock s where s.QTY = 0

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[GetAllPurchases]    Script Date: 2023-11-24 5:01:05 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[GetAllPurchases]
as
SELECT distinct p.[Id] as '«·„⁄—›'
      ,p.[InvoiceNumber] as '—ﬁ„ «·›« Ê—…'
      ,s.Name as '«·„Ê—œ'
      ,p.[DateOfPurchase] as ' «—ÌŒ «·‘—«¡'
	  ,py.Name as 'ÿ—Ìﬁ… «·œ›⁄'
	  ,p.price as '«Ã„«·Ì «·›« Ê—…'
      ,p.[PaidAmount] as '«·„»·€ «·„œ›Ê⁄'
      ,p.[RemainingAmount] as '«·„»·€ «·„ »ﬁÌ'
	   FROM [dbo].[Purchases] p
  join PurchaseDetails d
  on p.Id = d.PurchaseId
  join Suppliers s
  on 
  p.SupplierId = s.ID
  join Product t
  on
  d.ProductId = t.ID_Product
  join PaymentMethod py
  on py.Id = p.PaymentMethodId
--SELECT p.[Id] as '«·„⁄—›'
--      ,s.Name as '«·„Ê—œ'
--      ,t.Product_Name as '«·„‰ Ã'
--      ,p.[DateOfPurchase] as ' «—ÌŒ «·‘—«¡'
--      ,d.ExpDate as ' «—ÌŒ «·’·«ÕÌ…'
--      ,d.[QTY] as '«·ﬂ„Ì…'
--      ,d.PurchasePrice as '”⁄— «·‘—«¡'
--      ,d.SellingPrice as '”⁄— «·»Ì⁄'
--      ,d.TotalPrice as '«·”⁄—'
--      ,p.[PaidAmount] as '«·„»·€ «·„œ›Ê⁄'
--      ,p.[RemainingAmount] as '«·„»·€ «·„ »ﬁÌ'
--      ,p.[PaymentMethodId] as 'ÿ—Ìﬁ… «·œ›⁄'
--      ,p.[InvoiceNumber] as '—ﬁ„ «·›« Ê—…'
--      ,d.BatchNumber as '—ﬁ„ «·œ›⁄…'
--	  ,p.price as '«Ã„«·Ì «·›« Ê—…'
--  FROM [dbo].[Purchases] p
--  join PurchaseDetails d
--  on p.Id = d.PurchaseId
--  join Suppliers s
--  on 
--  p.SupplierId = s.ID
--  join Product t
--  on
--  d.ProductId = t.ID_Product

-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[SearchPurchases]    Script Date: 2023-11-24 5:06:29 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[SearchPurchases]
@search nvarchar(50)
as
SELECT distinct p.[Id] as '«·„⁄—›'
      ,p.[InvoiceNumber] as '—ﬁ„ «·›« Ê—…'
      ,s.Name as '«·„Ê—œ'
      ,p.[DateOfPurchase] as ' «—ÌŒ «·‘—«¡'
	  ,py.Name as 'ÿ—Ìﬁ… «·œ›⁄'
	  ,p.price as '«Ã„«·Ì «·›« Ê—…'
      ,p.[PaidAmount] as '«·„»·€ «·„œ›Ê⁄'
      ,p.[RemainingAmount] as '«·„»·€ «·„ »ﬁÌ'
	   FROM [dbo].[Purchases] p
  join PurchaseDetails d
  on p.Id = d.PurchaseId
  join Suppliers s
  on 
  p.SupplierId = s.ID
  join Product t
  on
  d.ProductId = t.ID_Product
  join PaymentMethod py
  on py.Id = p.PaymentMethodId
--SELECT p.[Id] as '«·„⁄—›'
--      ,s.Name as '«·„Ê—œ'
--      ,t.Product_Name as '«·„‰ Ã'
--      ,p.[DateOfPurchase] as ' «—ÌŒ «·‘—«¡'
--      ,d.ExpDate as ' «—ÌŒ «·’·«ÕÌ…'
--      ,d.[QTY] as '«·ﬂ„Ì…'
--      ,d.PurchasePrice as '”⁄— «·‘—«¡'
--      ,d.SellingPrice as '”⁄— «·»Ì⁄'
--      ,d.TotalPrice as '«·”⁄—'
--      ,p.[PaidAmount] as '«·„»·€ «·„œ›Ê⁄'
--      ,p.[RemainingAmount] as '«·„»·€ «·„ »ﬁÌ'
--      ,p.[PaymentMethodId] as 'ÿ—Ìﬁ… «·œ›⁄'
--      ,p.[InvoiceNumber] as '—ﬁ„ «·›« Ê—…'
--      ,d.BatchNumber as '—ﬁ„ «·œ›⁄…'
--	  ,p.price as '«Ã„«·Ì «·›« Ê—…'
--  FROM [dbo].[Purchases] p
--  join PurchaseDetails d
--  on p.Id = d.PurchaseId
--  join Suppliers s
--  on 
--  p.SupplierId = s.ID
--  join Product t
--  on
--  d.ProductId = t.ID_Product
  where s.Name  + py.Name  like '%' + @search + '%' 

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

create proc GetProformaInvoices
@search nvarchar(50)
as
SELECT [ID] as '„⁄—› «·›« Ê—…'
      ,[Date_ProformaInvoice] as ' «—ÌŒ «·›« Ê—…'
      ,c.First_Name + ' ' + c.Last_Name as '«·⁄„Ì·'
      ,[Des_ProformaInvoice] as 'Ê’› «·›« Ê—…'
      ,[SalesMan] as '„” Œ—Ã «·›« Ê—…'
  FROM [Product_DB].[dbo].[ProformaInvoice] pn
  join Customer c
  on pn.Customer_ID = c.ID_Customer
  where CONVERT(nvarchar(50), [Date_ProformaInvoice]) + CONVERT(nvarchar(50), [ID]) + c.First_Name + c.Last_Name + pn.SalesMan like '%' +@search+ '%'

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[GetProductPrice]    Script Date: 2023-11-24 6:01:05 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[GetProductPrice]
@search nvarchar(50)
as
SELECT p.[Id] as '«·„⁄—›' 
      ,t.ID_Product as '„⁄—› «·„‰ Ã'
      ,t.[Product_Name] as '«·„‰ Ã'
	  ,s.[Name] as '«·„Ê—œ'
      ,[BatchNumber] as '—ﬁ„ «·œ›⁄…'
      ,[PurchasePrice] as '”⁄— «·‘—«¡'
      ,[SellingPrice] as'”⁄— «·»Ì⁄'
	  ,u.[DateOfPurchase] as ' «—ÌŒ «·ÿ·»Ì…'
  FROM [dbo].[PurchaseDetails] p
  join Product t
  on t.ID_Product = p.ProductId
  join Purchases u
  on u.Id = p.PurchaseId
  join Suppliers s
  on s.ID = u.SupplierId
  where t.Product_Name + s.Name + CONVERT(nvarchar(50),p.BatchNumber) like '%' +@search+ '%'


  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[UpdateProductPrice]    Script Date: 2023-11-24 6:02:06 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER proc [dbo].[UpdateProductPrice]
@productId int,
@SellingPrice int
as
UPDATE [dbo].[PurchaseDetails]
   SET [SellingPrice] = @SellingPrice
 WHERE ProductId = @productId



-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[GetAllOrders]    Script Date: 2023-11-24 6:14:58 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[GetAllOrders]
@search nvarchar(50)
as
SELECT distinct o.[ID_Order] as '«·„⁄—›'
      ,[Date_Order] as ' «—ÌŒ «·ÿ·»Ì…'
      ,c.First_Name + ' ' + c.Last_Name as '«·⁄„Ì·'
      ,[Des_Order] as 'Ê’› «·ÿ·»Ì…'
      ,[SalesMan] as '«·»«∆⁄'
      ,[TotalAmount] as '«Ã„«·Ì «·›« Ê—…'
      ,[PaidAmount] as '«·„»·€ «·„œ›Ê⁄'
      ,[RemainingAmount] as '«·„»·€ «·„ »ﬁÌ'
  FROM [dbo].[Order] o
  join Customer c
  on c.ID_Customer = o.Customer_ID
  join Order_Details dt
  on dt.ID_Order = o.ID_Order
  where CONVERT(nvarchar(50), o.ID_Order) + o.Des_Order + CONVERT(nvarchar(50), o.Date_Order) + c.First_Name + c.Last_Name + o.SalesMan like '%' +@search+ '%'
  and o.TotalAmount > 0


  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[GetOrderInstallment]    Script Date: 2023-11-25 11:35:20 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER proc [dbo].[GetOrderInstallment]
@orderId int
as
SELECT distinct
       [PaymentDate] as ' «—ÌŒ «·ﬁ”ÿ'
      ,[OrderId] as '—ﬁ„ «·›« Ê—…'
      ,FORMAT([TotalAmount], 'N') as '«Ã„«·Ì „»·€ «·›« Ê—…'
      ,FORMAT([PaidAmount], 'N') as '«·„»·€ «·„œ›Ê⁄ ⁄‰œ «·”œ«œ'
      ,FORMAT([Remainamont], 'N') as '«·„»€ «·„ »ﬁÌ ⁄‰œ «·”œ«œ'
      ,FORMAT([CurrentPayment], 'N') as 'ﬁÌ„… «·œ›⁄Ì…'
  FROM [dbo].[OrderInstallment]
  where OrderId = @orderId

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

USE [Product_DB]
GO
/****** Object:  StoredProcedure [dbo].[GetPurchasesInstallment]    Script Date: 2023-11-25 11:50:47 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER proc [dbo].[GetPurchasesInstallment]
@orderId int
as
SELECT distinct
       [PaymentDate] as ' «—ÌŒ «·ﬁ”ÿ'
      ,[OrderId] as '—ﬁ„ «·›« Ê—…'
      ,FORMAT([TotalAmount], 'N') as '«Ã„«·Ì «·›« Ê—…'
      ,FORMAT([PaidAmount], 'N') as '«·„»·€ «·„œ›Ê⁄'
      ,FORMAT([Remainamont], 'N') as '«·„»·€ «·„ »ﬁÌ'
      ,FORMAT([CurrentPayment], 'N') as 'ﬁÌ„… «·œ›⁄Ì…'
  FROM [dbo].[PurchasesInstallment]
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

